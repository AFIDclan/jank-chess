#ifndef MAGIC_H
#define MAGIC_H

#include "types.h"

namespace Magic {

    void init();
    BBOARD getRookAttacks(int, BBOARD);
    BBOARD getBishopAttacks(int, BBOARD);

    // Many thanks to: https://www.chessprogramming.org/Looking_for_Magics
    constexpr int RBITS[64] = {
        12, 11, 11, 11, 11, 11, 11, 12,
        11, 10, 10, 10, 10, 10, 10, 11,
        11, 10, 10, 10, 10, 10, 10, 11,
        11, 10, 10, 10, 10, 10, 10, 11,
        11, 10, 10, 10, 10, 10, 10, 11,
        11, 10, 10, 10, 10, 10, 10, 11,
        11, 10, 10, 10, 10, 10, 10, 11,
        12, 11, 11, 11, 11, 11, 11, 12,
    };

    constexpr int RSIZE[64] = {
         4096,  2048,  2048,  2048,  2048,  2048,  2048,  4096,
         2048,  1024,  1024,  1024,  1024,  1024,  1024,  2048,
         2048,  1024,  1024,  1024,  1024,  1024,  1024,  2048,
         2048,  1024,  1024,  1024,  1024,  1024,  1024,  2048,
         2048,  1024,  1024,  1024,  1024,  1024,  1024,  2048,
         2048,  1024,  1024,  1024,  1024,  1024,  1024,  2048,
         2048,  1024,  1024,  1024,  1024,  1024,  1024,  2048,
         4096,  2048,  2048,  2048,  2048,  2048,  2048,  4096,
    };

    constexpr int ROFFSET[65] = {
              0,
           4096,    6144,    8192,   10240,   12288,   14336,   16384,   20480,
          22528,   23552,   24576,   25600,   26624,   27648,   28672,   30720,
          32768,   33792,   34816,   35840,   36864,   37888,   38912,   40960,
          43008,   44032,   45056,   46080,   47104,   48128,   49152,   51200,
          53248,   54272,   55296,   56320,   57344,   58368,   59392,   61440,
          63488,   64512,   65536,   66560,   67584,   68608,   69632,   71680,
          73728,   74752,   75776,   76800,   77824,   78848,   79872,   81920,
          86016,   88064,   90112,   92160,   94208,   96256,   98304,  102400,
    };

    // Many thanks to: https://www.chessprogramming.org/Looking_for_Magics
    constexpr int BBITS[64] = {
        6, 5, 5, 5, 5, 5, 5, 6,
        5, 5, 5, 5, 5, 5, 5, 5,
        5, 5, 7, 7, 7, 7, 5, 5,
        5, 5, 7, 9, 9, 7, 5, 5,
        5, 5, 7, 9, 9, 7, 5, 5,
        5, 5, 7, 7, 7, 7, 5, 5,
        5, 5, 5, 5, 5, 5, 5, 5,
        6, 5, 5, 5, 5, 5, 5, 6,
    };

    constexpr int BSIZE[64] = {
          64,   32,   32,   32,   32,   32,   32,   64,
          32,   32,   32,   32,   32,   32,   32,   32,
          32,   32,  128,  128,  128,  128,   32,   32,
          32,   32,  128,  512,  512,  128,   32,   32,
          32,   32,  128,  512,  512,  128,   32,   32,
          32,   32,  128,  128,  128,  128,   32,   32,
          32,   32,   32,   32,   32,   32,   32,   32,
          64,   32,   32,   32,   32,   32,   32,   64,
    };

    constexpr int BOFFSET[65] = {
              0,
             64,      96,     128,     160,     192,     224,     256,     320,
            352,     384,     416,     448,     480,     512,     544,     576,
            608,     640,     768,     896,    1024,    1152,    1184,    1216,
           1248,    1280,    1408,    1920,    2432,    2560,    2592,    2624,
           2656,    2688,    2816,    3328,    3840,    3968,    4000,    4032,
           4064,    4096,    4224,    4352,    4480,    4608,    4640,    4672,
           4704,    4736,    4768,    4800,    4832,    4864,    4896,    4928,
           4992,    5024,    5056,    5088,    5120,    5152,    5184,    5248,
    };

    constexpr BBOARD BMAGIC[64] {
        0x4002020208210501,
        0x000242244C008002,
        0x0808208122020000,
        0x0804041082084000,
        0x0204042081010060,
        0x020A080248005030,
        0x2002881802108010,
        0x0001004200A00800,
        0x040420081000C080,
        0x8010020808210040,
        0x0402440800911100,
        0x8000110400820A00,
        0x0106811041088300,
        0x0140913010100000,
        0xCC00088090101020,
        0x1001804108215008,
        0x2004001020420400,
        0x1003188408020400,
        0x004805300020A820,
        0x0002022422060000,
        0x1011000890400080,
        0x4001400208024000,
        0x1000400108025082,
        0x0C4903204408A440,
        0x0048050188103084,
        0x2001080090101114,
        0x0104100801010020,
        0x0404010200200880,
        0xA01100C00400C040,
        0x6020420004120200,
        0x2994010000480200,
        0x000200416A8C0084,
        0x001003208088080A,
        0x0804118800E00204,
        0xA941040114020802,
        0x4010100820040400,
        0x1040010100801040,
        0x1201410200010050,
        0x120A04291CC04800,
        0x1021020204002104,
        0x0004424210084005,
        0x050110821002A0C0,
        0x0801008040403400,
        0x0428402218000401,
        0x0000403020800410,
        0x1020600400400020,
        0x0010100A00840050,
        0x050208064100A094,
        0x202080B011100000,
        0x0140808088A04100,
        0x1045028098210000,
        0xC11000020A020401,
        0x8808224008220409,
        0xA020405012408800,
        0x400A200102021028,
        0x0010100089025888,
        0xA021818288A02006,
        0x0204144416180200,
        0x20200C0020941008,
        0x0000000180208814,
        0x080000A340850100,
        0x0182402120920881,
        0x000220028408009C,
        0x0020020440408202,
    };

    constexpr BBOARD BREVMASK[64] {
        0x0040201008040200,
        0x0000402010080400,
        0x0000004020100A00,
        0x0000000040221400,
        0x0000000002442800,
        0x0000000204085000,
        0x0000020408102000,
        0x0002040810204000,
        0x0020100804020000,
        0x0040201008040000,
        0x00004020100A0000,
        0x0000004022140000,
        0x0000000244280000,
        0x0000020408500000,
        0x0002040810200000,
        0x0004081020400000,
        0x0010080402000200,
        0x0020100804000400,
        0x004020100A000A00,
        0x0000402214001400,
        0x0000024428002800,
        0x0002040850005000,
        0x0004081020002000,
        0x0008102040004000,
        0x0008040200020400,
        0x0010080400040800,
        0x0020100A000A1000,
        0x0040221400142200,
        0x0002442800284400,
        0x0004085000500800,
        0x0008102000201000,
        0x0010204000402000,
        0x0004020002040800,
        0x0008040004081000,
        0x00100A000A102000,
        0x0022140014224000,
        0x0044280028440200,
        0x0008500050080400,
        0x0010200020100800,
        0x0020400040201000,
        0x0002000204081000,
        0x0004000408102000,
        0x000A000A10204000,
        0x0014001422400000,
        0x0028002844020000,
        0x0050005008040200,
        0x0020002010080400,
        0x0040004020100800,
        0x0000020408102000,
        0x0000040810204000,
        0x00000A1020400000,
        0x0000142240000000,
        0x0000284402000000,
        0x0000500804020000,
        0x0000201008040200,
        0x0000402010080400,
        0x0002040810204000,
        0x0004081020400000,
        0x000A102040000000,
        0x0014224000000000,
        0x0028440200000000,
        0x0050080402000000,
        0x0020100804020000,
        0x0040201008040200,
    };

    constexpr BBOARD RMAGIC[64] {
        0x0080116440008000,
        0x00C0400010002000,
        0x0080100080200008,
        0x0A80100008004482,
        0x0200020005082090,
        0x4900210008026400,
        0x0400100081080442,
        0x4200021081002044,
        0x0020802080004004,
        0x10214000A000D000,
        0x0003803000842001,
        0x0011002100100008,
        0x00A6002200081004,
        0x001E000410090200,
        0x10188009001A0080,
        0x0462000408628207,
        0x1080004000200044,
        0x0010004010402001,
        0x210080802000100A,
        0x0010010021091100,
        0x4180828014001800,
        0x9100808004000201,
        0x0140040002213008,
        0x80008A000192C104,
        0x0180004040002000,
        0x4010400100288104,
        0x1000402200120084,
        0x0900100080080080,
        0x1088000880040080,
        0x0483020080800400,
        0x6000020400100801,
        0x3400004200040081,
        0x0240204000800080,
        0xC1C0100043402001,
        0x0010040800202000,
        0x2808080080801000,
        0x0814000480800800,
        0x0280800400800200,
        0x0000500184000802,
        0x0001000041002092,
        0x2000420100820021,
        0x0410104020004008,
        0x4024120440820020,
        0x0000420020120008,
        0x0007000408010011,
        0xA008020004008080,
        0x10010A10010C0008,
        0x05020050A1020004,
        0x000047008001A900,
        0x48004A0080210200,
        0x0006802000100C80,
        0x4100100081880280,
        0x4228004200040040,
        0x0011000208040100,
        0x2000081041020400,
        0x1402008100440200,
        0x0000800990402501,
        0x0040021080482101,
        0x20C2002008801042,
        0x0140100100042009,
        0x0002001020850802,
        0x0011000208040001,
        0x0901001200018445,
        0x2040050C04208042,
    };

    constexpr BBOARD RREVMASK[64] {
        0x000101010101017E,
        0x000202020202027C,
        0x000404040404047A,
        0x0008080808080876,
        0x001010101010106E,
        0x002020202020205E,
        0x004040404040403E,
        0x008080808080807E,
        0x0001010101017E00,
        0x0002020202027C00,
        0x0004040404047A00,
        0x0008080808087600,
        0x0010101010106E00,
        0x0020202020205E00,
        0x0040404040403E00,
        0x0080808080807E00,
        0x00010101017E0100,
        0x00020202027C0200,
        0x00040404047A0400,
        0x0008080808760800,
        0x00101010106E1000,
        0x00202020205E2000,
        0x00404040403E4000,
        0x00808080807E8000,
        0x000101017E010100,
        0x000202027C020200,
        0x000404047A040400,
        0x0008080876080800,
        0x001010106E101000,
        0x002020205E202000,
        0x004040403E404000,
        0x008080807E808000,
        0x0001017E01010100,
        0x0002027C02020200,
        0x0004047A04040400,
        0x0008087608080800,
        0x0010106E10101000,
        0x0020205E20202000,
        0x0040403E40404000,
        0x0080807E80808000,
        0x00017E0101010100,
        0x00027C0202020200,
        0x00047A0404040400,
        0x0008760808080800,
        0x00106E1010101000,
        0x00205E2020202000,
        0x00403E4040404000,
        0x00807E8080808000,
        0x007E010101010100,
        0x007C020202020200,
        0x007A040404040400,
        0x0076080808080800,
        0x006E101010101000,
        0x005E202020202000,
        0x003E404040404000,
        0x007E808080808000,
        0x7E01010101010100,
        0x7C02020202020200,
        0x7A04040404040400,
        0x7608080808080800,
        0x6E10101010101000,
        0x5E20202020202000,
        0x3E40404040404000,
        0x7E80808080808000,
    };
};

#endif

